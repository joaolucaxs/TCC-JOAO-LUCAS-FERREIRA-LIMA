<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	<link rel="stylesheet" href="/css/styleMontagem.css">
	<title>Montagem</title>
</head>

<body>
	<div class="d-flex flex-row justify-content-between">

		<div>
		</div>
		<div>
		</div>
		<!-- Contêiner da montagem -->
		<div class="phone">
			<div class="screen">
				<div class="presentation-content">
					<div class="media-containers" id="mediaContainers">

						<div id="dropArea" class="media-container droppable" ondrop="drop(event)"
							ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
							<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
								data-bs-target="#offcanvasMidia" aria-controls="offcanvasMidia">Adicionar Mídia
							</button>
						</div>

						<div id="dropArea" class="media-container droppable" ondrop="drop(event)"
							ondragover="allowDrop(event)" ondragenter="dragEnter(event)" ondragleave="dragLeave(event)">
							<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
								data-bs-target="#offcanvasMidia" aria-controls="offcanvasMidia">Adicionar Mídia
							</button>
						</div>

					</div>
					<button class="btn btn-primary" onclick="addMediaContainer()">+</button>
				</div>
			</div>
		</div>


		<div class="d-flex flex-column justify-content-center">
			<button class="btn btn-primary mb-2" type="submit" id="salvarApresentacao">Salvar
				Apresentação</button>
			<a class="btn btn-danger mb-2 " href="/apresentacoes" role="button">Cancelar</a>
		</div>

		<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
			id="offcanvasMidia" aria-labelledby="offcanvasMidiaLabel">
			<div class="offcanvas-header">
				<h5 class="offcanvas-title" id="offcanvasMidiaLabel">Mídias Disponíveis</h5>
				<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
			</div>
			<div class="offcanvas-body">
				<div class="d-flex flex-column justify-content-center">
					<button class="btn btn-primary mb-3" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasImagens" aria-controls="offcanvasImagens">Imagens</button>

					<button class="btn btn-primary mb-3" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasVideos" aria-controls="offcanvasVideos">Videos</button>

					<button class="btn btn-primary mb-3" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasAudios" aria-controls="offcanvasAudios">Audios</button>

					<button class="btn btn-primary mb-3" type="button" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasTextos" aria-controls="offcanvasTextos">Textos</button>

					<button class="btn btn-primary mb-3" data-bs-target="#modalLinks" data-bs-toggle="modal">Links
						Específicos</button>

					<button class="btn btn-primary mb-3" data-bs-target="#modalApresentacoes"
						data-bs-toggle="modal">Apresentações</button>
				</div>
			</div>
		</div>

	</div>

	<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
		id="offcanvasImagens" aria-labelledby="offcanvasImagensLabel">
		<div class="offcanvas-header">
			<h5 class="offcanvas-title" id="offcanvasImagensLabel">Imagens Disponíveis</h5>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		</div>
		<div class="offcanvas-body">
			<div class="d-flex flex-wrap justify-content-around align-items-center mb-4">
				<div class="p-1">
					<h6>Filtrar por Obra:</h6>
				</div>
				<div class="p-1 col-md-7">
					<select class="form-select" id="obraSelectimagens" onchange="filtrarMidias('imagens')">
						<option value="">Todas as imagens</option>
						<option th:each="peca : ${pecas}" th:value="${peca.tituloPeca}" th:text="${peca.tituloPeca}">
						</option>
					</select>
				</div>
			</div>

			<div class="d-flex flex-column justify-content-center" id="imagensContainer">
				<div class="row row-cols-1 row-cols-md-2 g-4">
					<div class="col imagens" th:each="imagem : ${imagens}">
						<div class="d-flex flex-column justify-content-center align-items-center h-100" draggable="true"
							ondragstart="drag(event)">
							<img th:src="@{/arquivos/visualizar/{id}(id=${imagem.getId()})}" class="img-fluid mb-4"
								id="imagens" alt="Imagem">
							<div class="card-body">
								<h5 class="card-title text-center text-decoration-none"
									data-th-text="${imagem.getNomeArquivo()}"></h5>
								<h5 class="card-title text-center mb-4 text-decoration-none"
									data-th-text="${imagem.getPeca().getTituloPeca()}"></h5>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
		id="offcanvasVideos" aria-labelledby="offcanvasVideosLabel">
		<div class="offcanvas-header">
			<h5 class="offcanvas-title" id="offcanvasVideosLabel">Videos Disponíveis</h5>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		</div>
		<div class="offcanvas-body">
			<div class="d-flex flex-wrap justify-content-around align-items-center mb-4">
				<div class="p-1">
					<h6>Filtrar por Obra:</h6>
				</div>
				<div class="p-1 col-md-7">
					<select class="form-select" id="obraSelectvideos" onchange="filtrarMidias('videos')">
						<option value="">Todos os Vídeos</option>
						<option th:each="peca : ${pecas}" th:value="${peca.tituloPeca}" th:text="${peca.tituloPeca}">
						</option>
					</select>
				</div>
			</div>
			<div class="d-flex flex-column justify-content-center">
				<div class="row row-cols-1 row-cols-md-1 g-4">
					<div class="col videos" th:each="video : ${videos}">
						<div class="d-flex flex-column justify-content-center align-items-center h-100">
							<video class="mb-4" id="capa-video" draggable="true" ondragstart="drag(event)" controls>
								<source th:src="@{/arquivos/visualizar/{id}(id=${video.getId()})}" type="video/mp4">
							</video>
							<div class="card-body">
								<h5 class="card-title text-center text-decoration-none"
									data-th-text="${video.getNomeArquivo()}"></h5>
								<h5 class="card-title text-center mb-4 text-decoration-none"
									data-th-text="${video.getPeca().getTituloPeca()}"></h5>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
		id="offcanvasAudios" aria-labelledby="offcanvasAudiosLabel">
		<div class="offcanvas-header">
			<h5 class="offcanvas-title" id="offcanvasAudiosLabel">Audios Disponíveis</h5>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		</div>
		<div class="offcanvas-body">
			<div class="d-flex flex-wrap justify-content-around align-items-center mb-4">
				<div class="p-1">
					<h6>Filtrar por Obra:</h6>
				</div>
				<div class="p-1 col-md-7">
					<select class="form-select" id="obraSelectaudios" onchange="filtrarMidias('audios')">
						<option value="">Todos os Áudios</option>
						<option th:each="peca : ${pecas}" th:value="${peca.tituloPeca}" th:text="${peca.tituloPeca}">
						</option>
					</select>
				</div>
			</div>
			<div class="d-flex flex-column justify-content-center">
				<div class="row row-cols-2 row-cols-md-1 g-4">
					<div class="col audios" data-th-each="audio : ${audios}">
						<div class="d-flex flex-column justify-content-center align-items-center h-100">
							<audio class="mb-4" width="100%" height="auto" draggable="true" ondragstart="drag(event)"
								controls>
								<source th:src="@{/arquivos/visualizar/{id}(id=${audio.getId()})}" type="audio/mpeg">
							</audio>
							<div class="card-body">
								<h5 class="card-title text-center text-decoration-none"
									data-th-text="${audio.getNomeArquivo()}"></h5>
								<h5 class="card-title text-center mb-4 text-decoration-none"
									data-th-text="${audio.getPeca().getTituloPeca()}"></h5>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
		id="offcanvasTextos" aria-labelledby="offcanvasTextosLabel">
		<div class="offcanvas-header">
			<h5 class="offcanvas-title" id="offcanvasTextosLabel">Inserir um</h5>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
		</div>
		<div class="offcanvas-body">
			<div class="d-flex flex-column justify-content-center">
				<div class="row row-cols-2 row-cols-md-1 g-4">
					<h1 class="draggable editable" draggable="true" ondragstart="drag(event)">Título</h1>
					<h3 class="draggable editable" draggable="true" ondragstart="drag(event)">Sub-Título</h3>
					<p class="draggable editable" draggable="true" ondragstart="drag(event)">Parágrafo</p>
					<b class="draggable editable" draggable="true" ondragstart="drag(event)">Negrito</b>
					<big class="draggable editable" draggable="true" ondragstart="drag(event)">Texto Grande</big>
					<em class="draggable editable" draggable="true" ondragstart="drag(event)">Itálico</em>
					<blockquote class="draggable editable" draggable="true" ondragstart="drag(event)">Citação Longa
					</blockquote>
					<q class="draggable editable" draggable="true" ondragstart="drag(event)">Citação Curta</q>
					<del class="draggable editable" draggable="true" ondragstart="drag(event)">Deletar</del>
					<u class="draggable editable" draggable="true" ondragstart="drag(event)">Sublinhado</u>
				</div>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"
		integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa"
		crossorigin="anonymous"></script>

	<script>
		function addMediaContainer() {
			var mediaContainers = document.getElementById('mediaContainers');
			var newMediaContainer = document.createElement('div');
			newMediaContainer.classList.add('media-container', 'droppable');
			newMediaContainer.setAttribute('id', 'dropArea');
			newMediaContainer.ondrop = function (event) {drop(event)};
			newMediaContainer.ondragover = function (event) {allowDrop(event)};
			newMediaContainer.ondragenter = function (event) {dragEnter(event)};
			newMediaContainer.ondragleave = function (event) {dragLeave(event)};
			newMediaContainer.innerHTML = '<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"' +
				'data-bs-target="#offcanvasMidia" aria-controls="offcanvasMidia" >' +
				'Adicionar Mídia </button >';
			mediaContainers.appendChild(newMediaContainer);
		}

		function allowDrop(event) {
			event.preventDefault();
		}

		function drag(event) {
			var draggedElement = event.target;
			var clone = draggedElement.cloneNode(true);
			event.dataTransfer.setDragImage(clone, 50, 50);
			event.dataTransfer.setData("text", draggedElement.outerHTML);
		}

		function drop(event) {
			event.preventDefault();
			var data = event.dataTransfer.getData("text");
			var dropArea = event.target;

			if (dropArea.id === 'dropArea') {

				var updateButton = '<button class="btn btn-warning" id="btnClearCont" onclick = "clearContainer(this.parentNode)"><i class="bi bi-pen"></i></button></div>'
				var deleteButton = '<button class="btn btn-danger" id = "btnDelMidia" onclick = "deleteMedia(this.parentNode)"><i class="bi bi-x-lg"></i></button >'
				dropArea.innerHTML = updateButton + deleteButton + data;
				makeEditable(dropArea);
			}
			// Ajuste dinâmico da altura com base na altura da mídia adicionada
			var mediaHeight = dropArea.querySelector('img, video, audio, h1, h2, h3, p, b, i, big, em, blockquote, q, del, u').clientHeight;
			dropArea.style.minHeight = mediaHeight + 'px';
		}

		function makeEditable(dropArea) {
			// Encontrar os elementos editáveis dentro da dropArea e torná-los editáveis
			var editableElements = dropArea.querySelectorAll('.editable');
			editableElements.forEach(function (element) {
				element.contentEditable = true;
			});
		}

		function dragEnter(event) {
			var dropArea = event.target;
			if (dropArea.classList.contains('droppable') && !hasMedia(dropArea)) {
				dropArea.classList.add('drag-over');
			}
		}

		function dragLeave(event) {
			var dropArea = event.target;
			if (dropArea.classList.contains('droppable') && !hasMedia(dropArea)) {
				dropArea.classList.remove('drag-over');
			}
		}

		function hasMedia(dropArea) {
			// Verifica se a dropArea já contém algum elemento de mídia
			return dropArea.querySelector('img, video, audio, h1, h2, h3, p, b, big, em, blockquote, q, del, u') !== null;
		}

		function deleteMedia(mediaContainer) {
			// Remove o elemento de mídia e seu contêiner pai
			mediaContainer.parentNode.removeChild(mediaContainer);
			mediaContainer.style.minHeight = '250';
		}

		function clearContainer(clearMediaContainer) {
			// Remove todos os elementos filhos do mediaContainer
			while (clearMediaContainer.firstChild) {
				clearMediaContainer.removeChild(clearMediaContainer.firstChild);
			}

			// Restaura o mediaContainer ao estado original, adicionando o botão "Adicionar Mídia"
			clearMediaContainer.innerHTML = '<button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMidia" aria-controls="offcanvasMidia">Adicionar Mídia</button>';

			// Resetar a altura do mediaContainer
			clearMediaContainer.style.minHeight = '250px';
			clearMediaContainer.classList.remove('drag-over');
		}

		function filtrarMidias(tipoMidia) {
			var selectedObra = document.getElementById('obraSelect' + tipoMidia).value;

			var medias = document.querySelectorAll('.' + tipoMidia);

			medias.forEach(function (media) {
				var obraDaMidia = media.querySelector('.card-title.mb-4').innerText.trim();
				if (obraDaMidia === selectedObra || selectedObra === '') {
					media.style.display = 'block';
				} else {
					media.style.display = 'none';
				}
			});
		}

	</script>

</body>

</html>